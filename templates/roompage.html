{% extends "base.html" %}
{% block title %}
{{roomID}}
{% endblock %}
{% block content %}
<div id="RoomPageMainDiv">
    <div class="RoomPageInfo">
        <h1>{{room.room_name}}</h1>
        {% if room.room_name_aliases %}
        <span><strong>Aliases:</strong></span></br>
        {% for i in room.room_name_aliases %}
        {{ i.room_name_aliases }}</br>
        {% endfor %}
        {% endif %}
        <p>Block: {{room.room_block}}</p>
        <p>Floor: {{room.room_floor}}</p>
        <p>Room: {{room.room_number}}</p>
    </div>
    <div class="RoomPageStatus">
        <div>
            <p>Status:</p>
        </div>
        <form method="POST">
            <input type="radio" id="empty" name="room_status" value="-5" required>
            <label for="empty">Empty</label></br>
            <input type="radio" id="occupied" name="room_status" value="+5" required>
            <label for="occupied">Occupied</label></br></br>
            <input type="submit" value="Submit">
        </form>
        <div>
            <p>{{current_time_single.strftime("%B %d, %Y %I:%M%p")}}</p>
            {% if class_in_session_list %}
            <h4>Class in session:</h4>
            {% for class_in_session in class_in_session_list %}
            <p>{{class_in_session.class_subject_code}}  {{class_in_session.class_section}}  {{class_in_session.schedule_description}}</br>
            {{class_in_session.datetime_start(strftime="%A, %I:%M%p")}} - {{class_in_session.datetime_end(strftime="%I:%M%p")}}</br></br>   
            Schedule last updated: {{class_in_session.datetime_start(strftime="%B %d, %Y")}}</p>
            {% endfor %}
            {% endif %}
        </div>
        <div>
            {% if custom_in_session_list %}
            <h4>Meeting in session:</h4>
            {% for custom_in_session in custom_in_session_list %}
            <p>{{custom_in_session.schedule_description}}</br>
                {{custom_in_session.datetime_start(strftime="%A, %I:%M%p")}} - {{custom_in_session.datetime_end(strftime="%I:%M%p")}}</br></br></p>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    <div class="RoomClassSchedule">
        <div>
            {% if class_schedule_list %}
            <h4>Classes in this room:</h4>
            {% for schedule_single in class_schedule_list %}
            {% if loop.first  or (schedule_single.datetime_start("%A") != loop.previtem.datetime_start("%A"))%}
            <p>{{schedule_single.datetime_start(strftime="%A")}}</p>
            {% endif %}
            {{ schedule_single.class_subject_code }}  {{ schedule_single.class_section }}  {{schedule_single.schedule_description}}  {{schedule_single.datetime_start(strftime="%I:%M%p")}} - {{schedule_single.datetime_end(strftime="%I:%M%p")}}
            </br>
            {% endfor %}
            {% endif %}
        </div>
        <div>
            {% if custom_schedule_list %}
            <h4>Meetings in this room:</h4>
            {% for custom_single in custom_schedule_list %}
            <p>{{custom_single.datetime_start(strftime="%B %d, %Y | %I:%M%p")}} - 
            {% if custom_single.datetime_start(strftime="%B %d") != custom_single.datetime_end(strftime="%B %d") %}{{custom_single.datetime_end(strftime="%B %d, %Y")}}{% endif %}
            {{custom_single.datetime_end(strftime="%I:%M%p")}}</br>
            {{custom_single.schedule_description}}
            {% endfor %}
            {% endif %}
            </p>
        </div>
    </div>
    <div class="mapcontainer" id="map_fc842e841ad4e3d1b8937629f1f9ec04" ></div>
</div>


<script>
var bounds = [[2.929198, 101.641659], [2.928153, 101.640517]];

var map_fc842e841ad4e3d1b8937629f1f9ec04 = L.map("map_fc842e841ad4e3d1b8937629f1f9ec04", {
    center: [2.9287237444877112, 101.64111369303583],  
    zoom: 20,                       
    zoomControl: true,              
    scrollWheelZoom: true,          
    doubleClickZoom: true,          
    boxZoom: true,                  
    maxBounds: bounds,              
    maxBoundsViscosity: 1.0         
});

var tile_layer_83dec95f1ac1e96879a56d6b9ff972a2 = L.tileLayer(
    "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
    {
        "attribution": "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors",
        "detectRetina": false,
        "maxNativeZoom": 19,
        "maxZoom": 22,
        "minZoom": 20,
        "noWrap": false,
        "opacity": 1,
        "subdomains": "abc",
        "tms": false
    }
);

tile_layer_83dec95f1ac1e96879a56d6b9ff972a2.addTo(map_fc842e841ad4e3d1b8937629f1f9ec04);

var movela= 0.00004;
var movelo= 0.00012;

var enlargeLat = 0.00007;
var enlargeLng = 0.00007;

var image_bounds = [[2.9283 - movela - enlargeLat, 101.6403 + movelo - enlargeLng],[2.9292 - movela, 101.6417 + movelo]];

var floorImage = "/statics/images/floor0.png";
L.imageOverlay(floorImage, image_bounds, {
opacity: 0.7,
}).addTo(map_fc842e841ad4e3d1b8937629f1f9ec04);

var emptyicon = L.icon({
    iconUrl: '/static/images/roomempty.png',
    iconSize: [24, 24]
});

var inactiveicon = L.icon({
    iconUrl: '/static/images/roominactive.png',
    iconSize: [24, 24]
});

var occupiedicon = L.icon({
    iconUrl: '/static/images/roomoccupied.png',
    iconSize: [24, 24]
});

var defaulticon = L.icon({
    iconUrl: '/static/images/roominactive.png',
    iconSize: [24, 24]
})

$.getJSON("/get_markers//None", function(markers) {
markers.forEach(function(marker) {
    var icon;
    if (marker.weightage < 0) {
        icon = emptyicon;
    } else if (marker.weightage === 0) {
        icon = inactiveicon;
    } else if (marker.weightage > 0) {
        icon = occupiedicon;
    } else {
        icon = defaulticon;
    }

    L.marker([marker.lat, marker.lng], { icon: icon })
        .bindPopup(marker.popup)
        .addTo(map_fc842e841ad4e3d1b8937629f1f9ec04);
    });
});

</script>
{% endblock %}
